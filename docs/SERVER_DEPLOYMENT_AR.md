# دليل إعداد وتشغيل بوت lak24 AI على السيرفر

هذا الدليل مخصص لمساعدة العميل في رفع البوت إلى السيرفر وحل مشكلات جلب العروض والمنتجات من قاعدة بيانات Awin.

---

## 1. المتطلبات التقنية (Technical Requirements)
تأكد من أن السيرفر يدعم المواصفات التالية:
*   **PHP:** الإصدار 8.1 أو أحدث.
*   **إضافات PHP الضرورية:** `curl`, `json`, `mbstring`, `pdo_sqlite`, `sqlite3`, `gd`.
*   **محرك البحث SQLite FTS5:** يجب التأكد من أن نسخة SQLite على السيرفر تدعم **FTS5** (ضروري جداً لعمل محرك البحث بسرعة).
*   **Node.js:** يجب أن يكون مثبتًا لاستخراج النصوص من ملفات الـ PDF.

---

## 2. رفع الملفات وضبط الصلاحيات (Permissions)
بعد رفع مجلد البوت إلى السيرفر، يجب ضبط صلاحيات المجلدات التالية لتكون **قابلة للكتابة (Writable)** (عادةً 755 أو 775):

1.  `data/` : لتخزين قاعدة بيانات المنتجات.
2.  `sessions/` : لتخزين محادثات المستخدمين.
3.  `cache/` : لتخزين البيانات المؤقتة.
4.  `logs/` : لتخزين سجلات الأخطاء.
5.  `uploads/` : للملفات التي يرفعها المستخدمون.

---

## 3. إعداد ملف البيئة (.env)
بدلاً من تعديل ملفات الكود، استخدم ملف `.env` في المجلد الرئيسي لإضافة المفاتيح السرية:
```env
OPENAI_API_KEY=sk-proj-xxxx...
AMAZON_ACCESS_KEY=xxx...
AMAZON_SECRET_KEY=xxx...
AMAZON_PARTNER_TAG=xxx...
```

---

## 4. بناء قاعدة بيانات المنتجات (الحل لمشكلة عدم ظهور العروض)
إذا كان البوت يعطي روابط عامة (مثل "Notebook Link") بدلاً من منتجات حقيقية، فهذا يعني أن قاعدة البيانات المحلية فارغة أو لم يتم تحديثها.

**لحل هذه المشكلة، يجب تشغيل سكربت الاستيراد يدوياً لأول مرة:**
من خلال الـ SSH (Terminal)، قم بتنفيذ الأمر التالي:
```bash
php bin/import_awin.php
```
*سيقوم هذا الأمر بتحميل قائمة المنتجات من Awin وبناء محرك البحث المحلي. تأكد من وجود ملف `data/awin_products.db` بعد الانتهاء.*

---

## 5. تفعيل التحديث التلقائي (Cron Job)
لضمان تحديث الأسعار والمنتجات يومياً، يجب إعداد "Cron Job" على السيرفر ليعمل السكربت تلقائياً (مثلاً كل ليلة الساعة 3 صباحاً):
```bash
0 3 * * * /usr/bin/php /absolute/path/to/bin/import_awin.php >/dev/null 2>&1
```

---

## 6. تركيب البوت في الموقع
لإظهار أيقونة البوت في موقعك، أضف هذا السطر فقط في نهاية ملف الـ Footer الخاص بموقعك قبل إغلاق علامة `</body>`:
```html
<script src="/path/to/bot/assets/js/embed.js"></script>
```

---

## 7. استكشاف الأخطاء وإصلاحها
*   **البوت لا يظهر عروضاً حقيقية:** تأكد من تنفيذ الخطوة رقم 4 بنجاح.
*   **خطأ في رفع الملفات:** تأكد من صلاحيات مجلد `uploads`.
*   **سجلات الأخطاء:** يمكنك دائماً مراجعة المجلد `logs/` لمعرفة سبب أي توقف في الخدمة.
